const{dbDebugger}=require("../utils/debugger");function addOptions(t,e={}){const s=Object.keys(e);return s.length&&(s.includes("select")&&t.select(e.select),s.includes("and")&&t.and(e.and),s.includes("or")&&t.or(e.or),s.includes("sort")&&t.sort(e.sort),s.includes("limit")&&t.limit(e.limit),s.includes("count")&&t.countDocuments(),s.includes("skip")&&t.skip(e.skip)),t}function safeGuard(t={}){const e=Object.keys(t);if(e.length&&e.includes("select")&&e.includes("count"))throw new Error("Inconsistent query")}module.exports={create:async(t,e)=>{const i=await new t(e).save();dbDebugger(i)},getItems:async(t,e={},s={})=>{safeGuard(s);const i=t.find(e);return addOptions(i,s),await i.exec()},getItemsByPage:async(t,e,s={},i={})=>{safeGuard(i);const{pageSize:n,pageNumber:a}=e,c=t.find(s),l={...i,limit:n,skip:(a-1)*n};addOptions(c,l);const u=await c.exec();dbDebugger(u)}};
